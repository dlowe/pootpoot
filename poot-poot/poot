#!/usr/bin/env python
"""fetch metadata describing a single random interpretation"""

## app engine
from google.appengine.ext import webapp
from google.appengine.ext.webapp.util import run_wsgi_app

## this app
from pypoot import interpretation

class Poot(webapp.RequestHandler):
    """request handler for /poot"""

    def get(self):
        """handle a get request"""

        key_string = None
        if self.request.get('key'):
            key_string = self.request.get('key')

        i = interpretation.poot(key_string)

        self.response.headers.add_header('content-type', 'text/plain')
        self.response.out.write("""{
 "title": "%(title)s",
 "author": "%(author)s",
 "type": "%(type)s",
 "decorated_location": "/interpretation/%(key)s",
 "content_location": "/i/%(key)s"
}""" % {'key': i.key(), 'type': i.type, 'title': i.title, 'author': i.author })

APPLICATION = webapp.WSGIApplication([('/poot', Poot)], debug=True)

def main():
    """invoke the wsgi thingy"""
    run_wsgi_app(APPLICATION)

if __name__ == "__main__":
    main()
