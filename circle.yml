dependencies:
  pre:
    - curl -O https://googleappengine.googlecode.com/files/google_appengine_1.5.1.zip
    - unzip -d ~ google_appengine_1.5.1.zip

database:
  post:
    commands:
      - cp -R /opt/solr $HOME/solr
      - mkdir $HOME/solr/contexts
      - |
        cat > $HOME/solr/contexts/circle.xml <<EOF
        <?xml version="1.0" encoding="ISO-8859-1"?>
        <!DOCTYPE Configure PUBLIC "-//Jetty//Configure//EN" "http://www.eclipse.org/jetty/configure.dtd">
        <Configure class="org.eclipse.jetty.webapp.WebAppContext">
         <Set name="contextPath">/solr</Set>
         <Set name="war">./webapps/solr.war</Set>
        </Configure>
        EOF
      # - cp ~/pootpoot/config/solrconfig.xml $HOME/solr/solr/collection1/conf
      # - cp ~/pootpoot/config/schema.xml $HOME/solr/solr/collection1/conf
      - nohup bash -c "cd $HOME/solr; java -jar start.jar -Dsolr.velocity.enabled=false &" > $HOME/solr.log

test:
  override:
    - nosetests --with-gae --gae-lib-root=~/google_appengine --gae-application=poot-poot:
        environment:
          PYTHONPATH: $PYTHONPATH:~/google_appengine
    - cat $HOME/solr.log

deploy:
  master:
    branch: master
    commands:
      - ./deploy
